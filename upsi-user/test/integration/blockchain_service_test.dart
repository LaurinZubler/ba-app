import 'package:upsi_core/global.dart';
import 'package:upsi_user/data/ethereum_rpc_service.dart';
import 'package:upsi_user/data/i_blockchain_service.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:flutter_dotenv/flutter_dotenv.dart';

void main() {
  late IBlockchainService blockchainService;

  setUp(() async {
    await dotenv.load(fileName: ".env");
    blockchainService = EthereumRPCService();
  });

  group('Blockchain Integration Test', () {
    test('success', () async {
      const blockWithEvent = 13081956;
      final events = await blockchainService.getLogs(Global.UPSI_CONTRACT_ADDRESS, Global.UPSI_INFECTION_EVENT_TOPIC, blockWithEvent, blockWithEvent);
      expect(events, isNotNull);
      expect(events.length, 1);
      expect(events[0].data, "0x00000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000171796170200000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000010534d494c494e475f53594e44524f4d4500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000062307838323934373161363736373661336435633164626264643864643430383739643234306162323335646435316333626339643238323031393762626639376230653063313033313230366632353130313438326236656162623731626537346300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000406534386661653363323331373466323731363437366435396564306330313637393334303763376633323931313830363031626133336663343565623835323800000000000000000000000000000000000000000000000000000000000000c23078386461643939663334623736336431393436336238393662653139333934636461626162386562643339643839396431323366383734353138643433313563626235313465313139623836336664303763343761346364383562316235303935303538376432366231653166386132333866366465326231383634313434383039333133356165663636626533376339636364336465353463306233333664613730333231376332383565323534626264386265313332616261383361633261000000000000000000000000000000000000000000000000000000000000");
    });
  });
}
